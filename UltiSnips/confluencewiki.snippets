global !p
from snippet_functions import get_jira_summary, complete_from_list
endglobal

snippet "(\w+-\d+)" "<Ticket-Id> - Summary" r
`!p
snip.rv = match.group(1).upper()` - `!p
if not snip.c:
    snip.rv = get_jira_summary(match.group(1).upper(), snip)`
$0
endsnippet

snippet jira "<Ticket-ID> - <Summary>" !
${1:${VISUAL:ticket-id/(\w+)(-\d+)/\U$1\E$2 -/}} `!p
if re.match('[A-Z]+-\d+\s*-',t[1]):
    snip.rv = get_jira_summary(t[1].upper()[:-1].rstrip(), snip)`
$0
endsnippet

snippet reviewprotocol "-- Review Protocol v2.0 --" !b
------------------------------------------------------------------------
Review Protocol v2.0
------------------------------------------------------------------------
Reviewer: `!v g:snips_author`
------------------------------------------------------------------------
Date:     `!v strftime("%Y-%m-%d %H:%M")`
------------------------------------------------------------------------
Ticket:   ${1:`!v expand('%:t:r')`}
------------------------------------------------------------------------
A) Comments:
${2}
------------------------------------------------------------------------
B) To be fixed/explained by developer:
${3}
------------------------------------------------------------------------
C) Already fixed by reviewer:
${4}
------------------------------------------------------------------------
Result:   ${5}`!p snip.rv = complete_from_list(t[5], ["REVIEW OK", "FIX NEEDED", "RE-REVIEW NEEDED"])`
------------------------------------------------------------------------
endsnippet
